# Set execution policy (only needed in interactive contexts)
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser -Force
# Registry path and values for CVE-2022-0001 mitigation
$regPath = "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management"
$valueName1 = "FeatureSettingsOverride"
$valueName2 = "FeatureSettingsOverrideMask"
$valueData1 = 0x00800000
$valueData2 = 0x00000003
# Ensure the registry key path exists
if (-not (Test-Path $regPath)) {
    try {
        New-Item -Path $regPath -Force | Out-Null
        Write-Output "Created registry key path: $regPath"
    } catch {
        Write-Output "Failed to create registry key: $_"
        exit 1
    }
}
# Set the registry values
try {
    Set-ItemProperty -Path $regPath -Name $valueName1 -Value $valueData1 -Type DWord -Force
    Set-ItemProperty -Path $regPath -Name $valueName2 -Value $valueData2 -Type DWord -Force
    Write-Output "Registry values set successfully."
} catch {
    Write-Output "Failed to set registry values: $_"
    exit 1
}
# Verify the values
$values = Get-ItemProperty -Path $regPath -Name $valueName1, $valueName2
if ($values.$valueName1 -eq $valueData1 -and $values.$valueName2 -eq $valueData2) {
    Write-Output "Verified: CVE-2022-0001 registry mitigation applied."
} else {
    Write-Output "Registry values do not match expected settings."
} 

================================================================================================================

# Additional Check
Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name FeatureSettingsOverride, FeatureSettingsOverrideMask
